\documentclass[a4paper]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{tikz}
\usetikzlibrary{patterns, matrix}
\tikzstyle{NE-lines}=[pattern=north east lines, pattern color=black!45]

\newcommand{\fsum}[1]{\sum_{m\geq 0}m!\left(#1\right)^{m}}
\newcommand{\Sym}{\mathnormal{S}}
\newcommand{\Co}{\mathit{Co}}
\newcommand{\floor}[1]{\lfloor#1\rfloor}

% \pattern{ options to tikzpicture }{ |\pi| }{ pi }{ R }
% E.g., for p = ( 3241, { (0,2), (1,3), (1,4), (4,2), (4,3) } ) type:
% \pattern{}{ 4 }{ 1/3, 2/2, 3/4, 4/1 }{ 0/2, 1/3, 1/4, 4/2, 4/3 }
%
\newcommand{\pattern}[4]{
 \raisebox{0.6ex}{
 \begin{tikzpicture}[scale=0.25, baseline=(current bounding box.center), #1]
   \foreach \x/\y in {#4}
     \fill[NE-lines] (\x,\y) rectangle +(1,1);
   \draw (0.01,0.01) grid (#2+0.99,#2+0.99);
   \foreach \x/\y in {#3}
     \filldraw (\x,\y) circle (5pt);
 \end{tikzpicture}}
}

\newtheorem*{theorem}{Theorem}
% \newtheorem{proposition}[theorem]{Proposition}
% \newtheorem{lemma}[theorem]{Lemma}
% \newtheorem{corollary}[theorem]{Corollary}
% \newtheorem{openproblem}[theorem]{Open Problem}
% \newtheorem*{openproblem*}{Open Problem}
\newtheorem*{conjecture}{Conjecture}

% \theoremstyle{definition}
% \newtheorem{definition}[theorem]{Definition}
% \newtheorem{remark}[theorem]{Remark}
% \newtheorem*{remark*}{Remark}
% \newtheorem{example}[theorem]{Example}
% \newtheorem*{example*}{Example}

\title{Turning cycle restrictions to mesh patterns via Foata's fundamental transformation}
\author{Anders Claesson and Henning Ulfarsson}
\date{29 March 2023}

\begin{document}
\maketitle
\thispagestyle{empty}

\begin{abstract}
  An adjacent $q$-cycle is a natural generalization of an adjacent
  transposition. We show that the number of adjacent $q$-cycles in a
  permutation maps to the sum of occurrences of two mesh patterns under
  Foata's fundamental transposition. As a corollary we resolve
  Conjecture 3.14 in the paper ``From Hertzprung's problem to
  pattern-rewriting systems'' by the first author.
\end{abstract}

Following Brualdi and Deutsch~\cite{Brualdi2012} let $q$ be a positive integer and
define an \emph{adjacent $q$-cycle} in a permutation as a cycle of the form
\[(i,i+1,\ldots,i+q-1).
\]
In particular, an adjacent $1$-cycle is a fixed point and an adjacent
$2$-cycle is also known as an \emph{adjacent transposition}. Brualdi and
Deutsch showed, among other things, that if $a_q(n,k)$ is the number of
permutations that---when expressed as a product of disjoint cycles---have
exactly $k$ adjacent $q$-cycles, then
\[
  a_q(n,k) = \sum_{j=k}^{\floor{n/q}}(-1)^{k+j}\binom{j}{k}\frac{(n-(q-1)j)!}{j!}.
\]
Foata's fundamental transformation~\cite{foata} bijectively maps
permutations with $k$ cycles to permutations with $k$ left-to-right
minima by writing each cycle so that its leftmost element is the
smallest, sorting the cycles in descending order with respect to their
first element, and reading the resulting permutation as word from left
to right. For instance,
\[
  % 123456789
    134289657
   = (1)(2,3,4)(5,8)(6,9,7) \;\mapsto\; 123458697.
\]
TODO: Write the patterns below in the form they have on discord which
was correct after all \texttt{:-(}
\begin{alignat*}{2}
  r_1 &= \pattern{}{1}{1/1}{0/0,0/1,1/0}
  & s_1 &= \pattern{}{2}{1/1,2/2}{0/1,0/2,1/1,1/2,2/1}\\[1.5ex]
  r_2 &= \pattern{}{2}{2/1,1/2}{0/0,0/1,0/2,1/0,1/1,1/2,2/0,2/1}
  & s_2 &= \pattern{}{3}{1/1,2/3,3/2}{0/1,0/2,0/3,1/1,1/2,1/3,2/0,2/1,2/2,2/3,3/1,3/2} \\[1.5ex]
  r_3 &= \pattern{}{3}{3/1,2/2,1/3}{
    0/0,0/1,0/2,0/3,1/0,1/1,1/2,1/3,2/0,2/1,2/2,2/3,3/0,3/1,3/2}\qquad
  & s_3 &= \pattern{}{4}{1/1,2/4,3/3,4/2}{
    0/1,0/2,0/3,0/4,1/1,1/2,1/3,1/4,2/0,2/1,2/2,2/3,2/4,3/0,3/1,3/2,3/3,3/4,4/1,4/2,4/3} \\
\end{alignat*}

\begin{theorem}
    For $q \geq 1$ and a permutation $\pi$ the number of adjacent $q$-cycles in $\pi$ is
    equal to the sum of the number of occurrences of the mesh pattern $r_q$ and $s_q$ in the
    image of $\pi$ under Foata's fundamental transformation.
\end{theorem}

\begin{proof}

\end{proof}

The first author~\cite[Conjecture 3.14]{Cl2022} conjectured the following.
\begin{conjecture}
    We have
    \[\sum_{n\geq 0}|\Sym_n(p)|\mskip1mu x^n
        = \fsum{\frac{x}{1+x^2}},
        \;\text{ where }\,
        p = \pattern{}{3}{1/1,2/3/,3/2}{0/2,0/3,1/2,1/3,2/0,2/1,2/2,2/3,3/1,3/2}
    \]
    and $\Sym_n(p)$ denotes the set of permutations avoiding the mesh pattern $p$.
\end{conjecture}

Let us denote the right-hand side of the conjectured identity by $F(x)$, and
let $A(x)$ be the generating function for the
number of permutations of $[n]$ whose disjoint cycle decompositions have no adjacent
transpositions, that is, no cycles of the form $(i,i+1)$. The coefficients of $A(x)$
form sequence A177249 in the Online Encyclopedia of Integer Sequenes~\cite{OEIS}.
Brualdi and Deutsch~\cite{Brualdi2012} have shown that these two generating functions are related
by the identity
\begin{equation}\label{brualdi-deutsch}
    F(x) = (1+x^2)A(x).
\end{equation}
Consider a permutation that has no adjacent transpositions in its cycle decomposition.
When it is mapped through Foata's fundamental transformation~\cite{foata}---the left-to-right
maxima variation to be specific---the avoidance of adjacent transpositions translates to avoidance of
the two mesh patterns
\[
    q_1 = \pattern{}{2}{1/2,2/1}{0/0,0/1,0/2,1/0,1/1,1/2,2/0,2/1} \quad\text{and}\quad
    q_2 = \pattern{}{3}{1/1,2/3/,3/2}{0/1,0/2,0/3,1/1,1/2,1/3,2/0,2/1,2/2,2/3,3/1,3/2}
    % = \pattern{}{3}{1/1,2/3/,3/2}{0/2,0/3,1/2,1/3,2/0,2/1,2/2,2/3,3/1,3/2}
\]
By the Shading lemma~\cite{shading}, the pattern $p$ is \emph{coincident} with the pattern
$q_2$, in the sense that $\Sym_n(p) = \Sym_n(q_2)$ for all $n\geq 0$. By conditioning on
whether a permutation avoiding $q_2$ also avoids $q_1$ or contains $q_1$ we find that
\[
    \Sym_n(p) =  \Sym_n(q_1, q_2) \cup \bigl(\Co_n(q_1) \cap \Sym_n(q_2)\bigr),
\]
where the union is disjoint and $\Co_n(q_1)$ denotes the set of
permutations that contain $q_1$. Note that a permutation $\pi$ contains
$q_1$ and avoids $q_2$ precisely when it is the direct sum
$\pi=21\oplus\sigma$ of the permutation $21$ and a permutation $\sigma$
that avoids $q_1$ and $q_2$.  Indeed, \dots
\textbf{TODO: Argue why this is true!}
Using equation~\eqref{brualdi-deutsch} we have now
established that the conjecture is true.

% We highlight that the first author also stated an alternative version of the conjecture,
% by noting that the compositional inverse of $x/(1+x^2)$ is $xC(x^2)$, where $C(x)$ is the
% generating function for the Catalan numbers. This implies that the conjecture we have
% proven is equivalent to
% \[[x^n]F(xC(x^2))=n!
% \]
% Structurally this should be viewed as a
% saying that any permutation can be uniquely obtained from a permutation that avoids $p$, by
% replacing each of its points with a unique permutation from a family of permutations
% enumerated by $xC(x^2)$. We have not been able to describe this structural decomposition.

\subsection*{Acknowledgements}
This work was started at Schloss Dagstuhl (Leibniz-Zentrum f√ºr
Informatik), seminar 23121, and we thank the institute and the
organizers for the opportunity for us to participate.

\bibliographystyle{plain}
\bibliography{hertz}

\end{document}
